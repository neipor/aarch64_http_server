# 性能测试脚本

本目录包含用于验证 ANX HTTP Server 性能的自动化测试脚本。

## 脚本说明

### `quick_benchmark.sh` - 快速性能测试
- **用途**: 快速验证 ANX 与 Nginx 的性能对比
- **测试时长**: 10秒
- **并发连接**: 100
- **测试内容**: 静态文件服务性能
- **输出**: 简单的CSV格式结果

### `benchmark.sh` - 完整性能测试
- **用途**: 全面的性能基准测试
- **测试服务器**: ANX、Nginx、Apache、Tomcat
- **测试时长**: 30秒
- **并发连接**: 1000
- **测试内容**: 静态文件、并发处理、内存使用、启动时间
- **输出**: 详细的Markdown报告

## 使用方法

### 快速测试（推荐）
```bash
# 运行快速性能测试
./scripts/quick_benchmark.sh
```

### 完整测试
```bash
# 运行完整性能测试
./scripts/benchmark.sh
```

## 系统要求

- **操作系统**: Linux (Ubuntu/Debian 推荐)
- **架构**: aarch64 (ARM64)
- **依赖**: curl, wrk, make, gcc
- **权限**: 需要 sudo 权限安装软件包

## 测试环境

### 自动安装的软件
- **wrk**: HTTP压力测试工具
- **Nginx**: 1.24.0 或系统包管理器版本
- **Apache**: 系统包管理器版本
- **Tomcat**: 10.1.17

### 测试文件
- 自动创建 `test_web_root/` 目录
- 生成测试用的HTML文件
- 支持不同大小的文件测试

## 输出结果

### 快速测试输出
- `benchmark_results.csv`: CSV格式的测试结果
- `benchmark_report.txt`: 简单的文本报告

### 完整测试输出
- `benchmark_results/performance_report.md`: 详细的Markdown报告
- `benchmark_results/summary.txt`: 测试结果摘要
- `benchmark_logs/`: 详细的测试日志

## 测试指标

### 性能指标
- **请求/秒 (Requests/sec)**: 每秒处理的HTTP请求数
- **延迟 (Latency)**: 平均响应时间
- **传输速率 (Transfer/sec)**: 每秒传输的数据量
- **内存使用**: 服务器进程的内存占用
- **启动时间**: 服务器启动所需时间

### 对比维度
- **静态文件服务性能**
- **并发处理能力**
- **内存使用效率**
- **配置复杂度**
- **启动速度**

## 注意事项

1. **测试环境**: 确保测试环境干净，避免其他服务干扰
2. **系统资源**: 测试期间会占用较多CPU和内存资源
3. **网络端口**: 测试使用40080-40083端口，确保端口未被占用
4. **权限要求**: 需要sudo权限安装软件包和启动服务

## 故障排除

### 常见问题
1. **wrk未安装**: 脚本会自动尝试安装，失败请手动安装
2. **端口被占用**: 修改脚本中的端口配置
3. **权限不足**: 确保有sudo权限
4. **编译失败**: 检查ANX的编译依赖

### 调试模式
```bash
# 启用调试输出
set -x
./scripts/quick_benchmark.sh
```

## 自定义测试

### 修改测试参数
编辑脚本中的配置变量：
```bash
TEST_DURATION=30        # 测试时长（秒）
CONCURRENT_CONNECTIONS=1000  # 并发连接数
```

### 添加新的测试服务器
在 `benchmark.sh` 中添加新的服务器配置：
```bash
# 添加服务器到测试列表
local servers=("anx" "nginx" "apache" "tomcat" "new_server")
local ports=($ANX_PORT $NGINX_PORT $APACHE_PORT $TOMCAT_PORT $NEW_SERVER_PORT)
```

## 结果分析

### 性能对比解读
1. **请求/秒**: 数值越高越好，表示处理能力更强
2. **延迟**: 数值越低越好，表示响应更快
3. **内存使用**: 数值越低越好，表示资源效率更高
4. **启动时间**: 数值越低越好，表示部署更快

### 测试报告示例
```
=== ANX vs Nginx 性能对比 ===
测试时间: 2025-01-11 10:30:00
测试时长: 30秒
并发连接: 1000

服务器,请求/秒,延迟,内存使用
anx,50000,2.5ms,50MB
nginx,45000,3.2ms,80MB
```

## 贡献

欢迎改进测试脚本！请确保：
1. 保持测试的公平性和可重复性
2. 添加适当的错误处理
3. 更新文档说明
4. 测试新功能的有效性 